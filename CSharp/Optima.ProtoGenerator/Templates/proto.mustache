syntax = "proto3";

option csharp_namespace = "{{CsNamespace}}";

import public "lin.proto";
import public "google/protobuf/empty.proto";

package {{Package}};

message {{RequestName}} {
    {{RequestFields}}
}

message {{ResponseName}} {
    {{ResponseFields}}
}


service Calc {
    rpc Run (stream {{RequestName}}) returns (stream {{ResponseName}}); // End User needs to implement this one only, all others are autogenerated 
    
    rpc RunWithLineage (stream {{RequestNameLin}}) returns (stream {{ResponseNameLin}});

    rpc Echo ({{RequestName}}) returns ({{RequestName}}); // Useful for "is alive" validations
}

message {{RequestNameLin}} {
    oneof case {
        {{RequestName}} request = 1;
        lin.DatasetLineage datasetLineage = 2;
    }
}

message {{ResponseNameLin}} {
    message RowResponse {
        repeated {{ResponseName}} row = 1;
        repeated lin.RowLineage rowLineage = 2;
    }

    oneof result {
        lin.DatasetLineage datasetLineage = 1; // First message only
        {{ResponseName}} row = 2; 
        RowResponse rowResponse = 3;
    }
}
